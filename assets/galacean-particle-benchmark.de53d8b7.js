import"./modulepreload-polyfill.c7c6310f.js";import{L as k,f as D,W as C,g as f,V as I,C as T,A as _,h as A,i as M,E as L,j as H,k as R,l as P,m as u}from"./module.a644fe30.js";import"./index.f67971e6.js";function p(n,r){return r!=null&&typeof Symbol<"u"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}function g(n,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function b(n,r,e){return r&&g(n.prototype,r),e&&g(n,e),n}var m=0;function N(){var n=function(a,s){e.get(a)==null&&(e.set(a,s),m+=s)},r=XMLHttpRequest.prototype.send,e=new Map;XMLHttpRequest.prototype.send=function(t){this.addEventListener("load",function(){var s=0;this.responseType===""||this.responseType==="text"?s=new Blob([JSON.stringify(this.responseText)]).size:p(this.response,Blob)?s=this.response.size:p(this.response,ArrayBuffer)?s=this.response.byteLength:this.responseType==="json"&&(s=new Blob([JSON.stringify(this.response)]).size),n(this.responseURL,s)},!1),r.call(this,t);var a=Object.getOwnPropertyDescriptor(Image.prototype,"src").set;this.originalImageSrc=a,Object.defineProperty(Image.prototype,"src",{set:function(o){var i=this;fetch(o).then(function(d){d.ok&&d.blob().then(function(l){n(i.responseURL,l.size)})}),a.call(this,o)}})}}var O=function(){function n(){this._hooked=!1,this._hooked=!0}var r=n.prototype;return r.reset=function(){m=0},r.release=function(){this._hooked&&(XMLHttpRequest.prototype.send=this._originalSend,Object.defineProperty(Image.prototype,"src",{set:function(a){this.src.call(this,a)}})),this._hooked=!1},b(n,[{key:"size",get:function(){return z(m/1024/1024)}}]),n}();function z(n){return Number(n).toFixed(Math.max(6-n.toString().split(".")[0].length,0))}function w(n,r){(r==null||r>n.length)&&(r=n.length);for(var e=0,t=new Array(r);e<r;e++)t[e]=n[e];return t}function G(n){if(Array.isArray(n))return w(n)}function q(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function j(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F(n,r){if(!!n){if(typeof n=="string")return w(n,r);var e=Object.prototype.toString.call(n).slice(8,-1);if(e==="Object"&&n.constructor&&(e=n.constructor.name),e==="Map"||e==="Set")return Array.from(e);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return w(n,r)}}function S(n){return G(n)||q(n)||F(n)||j()}function h(){for(var n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];var t;(t=k).info.apply(t,["\u{1F680} [galacean engine--stats]"].concat(S(r)))}function v(){for(var n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];var t;(t=k).error.apply(t,["\u{1F680} [galacean engine-stats]"].concat(S(r)))}var B=function(){function n(e){this.drawCall=0,this.triangles=0,this.lines=0,this.points=0,this.realDrawElements=e.drawElements,this.realDrawArrays=e.drawArrays,e.drawElements=this.hookedDrawElements.bind(this),e.drawArrays=this.hookedDrawArrays.bind(this);var t=this.hasInstancedFunction(e);if(t)this.realDrawElementsInstanced=e.drawElementsInstanced,this.realDrawArraysInstanced=e.drawArraysInstanced,e.drawElementsInstanced=this.hookedDrawElementsInstanced.bind(this),e.drawArraysInstanced=this.hookedDrawArraysInstanced.bind(this);else{var a=e.getExtension("ANGLE_instanced_arrays");a?(this.realDrawElementsInstanced=a.drawElementsInstancedANGLE,this.realDrawArraysInstanced=a.drawArraysInstancedANGLE,a.drawElementsInstancedANGLE=this.hookedDrawElementsInstanced.bind(this),a.drawArraysInstancedANGLE=this.hookedDrawArraysInstanced.bind(this)):v("GPU Instancing is not supported.")}this.hooked=!0,this.gl=e,h("DrawCall is hooked.")}var r=n.prototype;return r.hasInstancedFunction=function(t){return p(t,WebGL2RenderingContext)||t.hasOwnProperty("drawElementsInstanced")&&t.hasOwnProperty("drawArraysInstanced")},r.hookedDrawElements=function(t,a,s,o){this.realDrawElements.call(this.gl,t,a,s,o),this.update(a,t)},r.hookedDrawArrays=function(t,a,s){this.realDrawArrays.call(this.gl,t,a,s),this.update(s,t)},r.hookedDrawElementsInstanced=function(t,a,s,o,i){this.realDrawElementsInstanced.call(this.gl,t,a,s,o,i),this.update(a,t)},r.hookedDrawArraysInstanced=function(t,a,s,o){this.realDrawArraysInstanced.call(this.gl,t,a,s,o),this.update(s,t)},r.update=function(t,a){var s=this.gl;switch(this.drawCall++,a){case s.TRIANGLES:this.triangles+=t/3;break;case s.TRIANGLE_STRIP:case s.TRIANGLE_FAN:this.triangles+=t-2;break;case s.LINES:this.lines+=t/2;break;case s.LINE_STRIP:this.lines+=t-1;break;case s.LINE_LOOP:this.lines+=t;break;case s.POINTS:this.points+=t;break;default:v("Unknown draw mode: "+a);break}},r.reset=function(){this.drawCall=0,this.triangles=0,this.lines=0,this.points=0},r.release=function(){if(this.hooked){var t=this.gl;t.drawElements=this.realDrawElements,t.drawArrays=this.realDrawArrays;var a=this.hasInstancedFunction(t);if(a)t.drawElementsInstanced=this.realDrawElementsInstanced,t.drawArraysInstanced=this.realDrawArraysInstanced;else{var s=t.getExtension("ANGLE_instanced_arrays");s&&(s.drawElementsInstancedANGLE=this.realDrawElementsInstanced,s.drawArraysInstancedANGLE=this.realDrawArraysInstanced)}}this.hooked=!1},n}(),W=function(){function n(e){this.shaders=0,this.realAttachShader=e.attachShader,this.realDetachShader=e.detachShader,e.attachShader=this.hookedAttachShader.bind(this),e.detachShader=this.hookedDetachShader.bind(this),this.hooked=!0,this.gl=e,h("Shader is hooked.")}var r=n.prototype;return r.hookedAttachShader=function(t,a){this.realAttachShader.call(this.gl,t,a),this.shaders++,h("AttachShader:",a,"shaders: "+this.shaders)},r.hookedDetachShader=function(t,a){this.realDetachShader.call(this.gl,t,a),this.shaders--,h("DetachShader. shaders: "+this.shaders)},r.reset=function(){this.shaders=0},r.release=function(){this.hooked&&(this.gl.attachShader=this.realAttachShader,this.gl.detachShader=this.realDetachShader),this.hooked=!1},n}(),U=function(){function n(e){this.textures=0,this.realCreateTexture=e.createTexture,this.realDeleteTexture=e.deleteTexture,e.createTexture=this.hookedCreateTexture.bind(this),e.deleteTexture=this.hookedDeleteTexture.bind(this),this.hooked=!0,this.gl=e,h("Texture is hooked.")}var r=n.prototype;return r.hookedCreateTexture=function(){var t=this.realCreateTexture.call(this.gl);return this.textures++,h("CreateTexture:",t,"textures: "+this.textures),t},r.hookedDeleteTexture=function(t){this.realDeleteTexture.call(this.gl,t),this.textures--,h("DeleteTexture. textures: "+this.textures)},r.reset=function(){this.textures=0},r.release=function(){this.hooked&&(this.gl.createTexture=this.realCreateTexture,this.gl.deleteTexture=this.realDeleteTexture),this.hooked=!1},n}(),X=function(){function n(e){this.samplingFrames=60,this.samplingIndex=0,this.updateCounter=0,this.updateTime=0,this.gl=e,this.hook(e)}var r=n.prototype;return r.hook=function(t){this.drawCallHook=new B(t),this.textureHook=new U(t),this.shaderHook=new W(t),this.requestHook=new O},r.reset=function(){this.drawCallHook&&this.drawCallHook.reset()},r.release=function(){this.drawCallHook&&this.drawCallHook.release(),this.textureHook&&this.textureHook.release(),this.shaderHook&&this.shaderHook.release()},r.update=function(){this.updateCounter++;var t=performance.now();if(!(t-this.updateTime<1e3)){if(this.samplingIndex!==this.samplingFrames){this.reset(),this.samplingIndex++;return}this.samplingIndex=0;var a={fps:Math.round(this.updateCounter*1e3/(t-this.updateTime)),memory:performance.memory&&performance.memory.usedJSHeapSize/1048576>>0,drawCall:this.drawCallHook.drawCall,triangles:this.drawCallHook.triangles,lines:this.drawCallHook.lines,points:this.drawCallHook.points,textures:this.textureHook.textures,size:this.requestHook.size,shaders:this.shaderHook.shaders,webglContext:window.hasOwnProperty("WebGL2RenderingContext")&&p(this.gl,WebGL2RenderingContext)?"2.0":"1.0"};return this.reset(),this.updateCounter=0,this.updateTime=t,a}},n}(),J=`
  <dl>
    <dt>FPS</dt>
    <dd>0</dd>
    <dt>Memory <span class="unit">(MB)</span></dt>
    <dd>0</dd>
    <dt>DrawCall</dt>
    <dd>0</dd>
    <dt>Triangles</dt>
    <dd>0</dd>
    <dt>Textures</dt>
    <dd>0</dd>
    <dt>Shaders</dt>
    <dd>0</dd>
    <dt>Network Size <span class="unit">(MB)</span></dt>
    <dd>0</dd>
    <dt>WebGL</dt>
    <dd></dd>
  </dl>
`,V=`
  .gl-perf {
    pointer-events: none;
    user-select: none;
    position: fixed;
    top: 0;
    left: 0;
    padding: `+10/7.5+"vh "+10/7.5+"vh 0 "+10/7.5+`vh;
    background: rgba(0, 0, 0, 0.3);
    color: #fff;
    font: `+10/7.5+`vh arial;
  }

  .gl-perf dl,
  .gl-perf dt,
  .gl-perf dd {
    padding: 0;
    margin: 0;
  }

  .gl-perf dt {
    color: #fff;
    text-shadow: #000 0 0 1px;
  }

  .gl-perf dt .unit{
    font-size: `+10/7.5+`vh;
  }

  .gl-perf dd {
    font-size: `+20/7.5+`vh;
    padding: `+10/7.5+"vh 0 "+10/7.5+`vh;
  }
`,Z=function(){function n(e){this.core=new X(e),this.items=[],this.items=["fps","memory","drawCall","triangles","textures","shaders","size","webglContext"],this.createContainer(),this.update=this.update.bind(this)}var r=n.prototype;return r.createContainer=function(){var t=document.createElement("div");t.classList.add("gl-perf"),t.innerHTML=J,t.appendChild(this.createStyle()),document.body.appendChild(t),this.doms=Array.prototype.slice.apply(t.querySelectorAll("dd")),this.container=t},r.createStyle=function(){var t=document.createElement("style");return t.type="text/css",t.appendChild(document.createTextNode(V)),t},r.update=function(){var t=this.core.update();if(t)for(var a=this,s=function(d,l){var c=a.doms[d],x=a.items[d],E=t[x]||0;requestAnimationFrame(function(){c.innerText=E})},o=0,i=this.items.length;o<i;o++)s(o,i)},r.reset=function(){this.core.reset()},r.release=function(){this.core.release()},r.destroy=function(){this.release(),document.body.removeChild(this.container)},n}();function y(n,r){return y=Object.setPrototypeOf||function(t,a){return t.__proto__=a,t},y(n,r)}function $(n,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(r&&r.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),r&&y(n,r)}var K=function(n){$(r,n);function r(){return n.apply(this,arguments)}var e=r.prototype;return e.onBeginRender=function(a){this.camera=a,this.monitor||this._setupMonitor()},e.onEndRender=function(a){this.monitor&&this.monitor.update()},e._setupMonitor=function(){var a=this.camera.engine._hardwareRenderer.gl;a&&(this.monitor=new Z(a))},r.hookRequest=function(){N()},b(r,[{key:"enabled",set:function(a){a?this._setupMonitor():this.monitor.destroy()}}]),r}(D);C.create({canvas:"canvas",graphicDeviceOptions:{powerPreference:"high-performance"}}).then(n=>{k.enable(),n.canvas.resizeByClientSize();const r=n.sceneManager.activeScene,e=r.createRootEntity();r.background.solidColor=new f(.25,.25,.25,1);const t=e.createChild("camera_entity");t.transform.position=new I(0,1,130);const a=t.addComponent(T);a.farClipPlane=200,t.addComponent(K),a.fieldOfView=60,console.time("load"),n.resourceManager.load({url:"https://playground.babylonjs.com/textures/flare.png",type:_.Texture2D}).then(s=>{const o=new A(n);o.baseColor=new f(1,1,1,1),o.blendMode=M.Additive,o.baseTexture=s;const i=Q(n,o);for(let d=0;d<18;d++)for(let l=0;l<12;l++){const c=i.clone();c.transform.setPosition(d*15-130,l*10-60,0),e.addChild(c)}console.timeEnd("load")}),n.run()});function Q(n,r){const e=new L(n);e.transform.rotate(90,0,0);const t=e.addComponent(H);t.setMaterial(r);const a=t.generator,{main:s,emission:o}=a,i=new R;return i.radius=1,o.shape=i,s.startColor.mode=P.TwoConstants,s.startColor.constantMin=new f(1,0,0,1),s.startColor.constantMax=new f(0,1,0,1),s.startSize.mode=u.TwoConstants,s.startSize.constantMin=.1,s.startSize.constantMax=.5,s.startLifetime.mode=u.TwoConstants,s.startLifetime.constantMin=.3,s.startLifetime.constantMax=1.5,o.rateOverTime.constant=1e3,s.gravityModifier.mode=u.Constant,s.gravityModifier.constant=1,s.startRotation3D=!0,s.startRotationX.constant=0,s.startRotationZ.constant=Math.PI,s.startSpeed.mode=u.TwoConstants,s.startSpeed.constantMin=1,s.startSpeed.constantMax=3,e}
