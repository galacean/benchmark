import{C as k,c as s,V as _,d as g,e as M,f as w,g as d,h as P}from"./index.0d9be172.js";function T(l,r){for(var h=0;h<r.length;h++){var t=r[h];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(l,t.key,t)}}function x(l,r,h){return r&&T(l.prototype,r),h&&T(l,h),l}function y(l,r){return y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},y(l,r)}function z(l,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(r&&r.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),r&&y(l,r)}var H=function(l){z(r,l);function r(){var t;return t=l.apply(this,arguments)||this,t.inputDevices=[g,M,w],t.autoRotate=!1,t.autoRotateSpeed=Math.PI,t.enableDamping=!0,t.rotateSpeed=1,t.zoomSpeed=1,t.keyPanSpeed=7,t.dampingFactor=.1,t.zoomFactor=.2,t.minDistance=.1,t.maxDistance=1/0,t.minZoom=0,t.maxZoom=1/0,t.minPolarAngle=1/180*Math.PI,t.maxPolarAngle=179/180*Math.PI,t.minAzimuthAngle=-1/0,t.maxAzimuthAngle=1/0,t._enableKeys=!0,t._up=new _(0,1,0),t._target=new _,t._atTheBack=!1,t._spherical=new d,t._sphericalDelta=new d,t._sphericalDump=new d,t._zoomFrag=0,t._scale=1,t._panOffset=new _,t._tempVec3=new _,t._enableHandler=s.All,t}var h=r.prototype;return h.onAwake=function(){var e=this,i=e.engine,a=e.entity;this.canvas=i.canvas,this.input=i.inputManager,this.camera=a.getComponent(k),this.cameraTransform=a.transform,this._spherical.setYAxis(this._up),this._atTheBack=!1},h.onLateUpdate=function(e){this._updateInputDelta(e),this._updateTransform()},h._updateInputDelta=function(e){for(var i=s.None,a=this,o=a._tempVec3,n=a._enableHandler,c=this,p=c.inputDevices,A=c.input,f=p.length-1;f>=0;f--){var b=p[f],m=b.onUpdateHandler(A);if(m&n)switch(i|=m,b.onUpdateDelta(this,o),m){case s.ROTATE:this._rotate(o);break;case s.ZOOM:this._zoom(o);break;case s.PAN:this._pan(o);break}}var O=this,v=O._sphericalDump,u=O._sphericalDelta;if(this.enableDamping&&(n&s.ZOOM&&i^s.ZOOM&&(this._zoomFrag*=1-this.zoomFactor),n&s.ROTATE&&i^s.ROTATE&&(u.theta=v.theta*=1-this.dampingFactor,u.phi=v.phi*=1-this.dampingFactor)),i===s.None&&this.autoRotate){var D=this.autoRotateSpeed*e;u.theta-=D}},h._rotate=function(e){var i=2*Math.PI*e.x/this.canvas.width*this.rotateSpeed;this._sphericalDelta.theta-=i;var a=2*Math.PI*e.y/this.canvas.height*this.rotateSpeed;this._sphericalDelta.phi-=a,this.enableDamping&&(this._sphericalDump.theta=-i,this._sphericalDump.phi=-a)},h._zoom=function(e){e.y>0?this._scale/=Math.pow(.95,this.zoomSpeed):e.y<0&&(this._scale*=Math.pow(.95,this.zoomSpeed))},h._pan=function(e){var i=this.cameraTransform,a=i.worldMatrix.elements,o=this.canvas.height,n=_.distance(i.position,this.target)*(this.camera.fieldOfView/2)*(Math.PI/180),c=-2*e.x*(n/o),p=2*e.y*(n/o);this._panOffset.x+=a[0]*c+a[4]*p,this._panOffset.y+=a[1]*c+a[5]*p,this._panOffset.z+=a[2]*c+a[6]*p},h._updateTransform=function(){var e=this,i=e.cameraTransform,a=e.target,o=e._tempVec3,n=e._spherical,c=e._sphericalDelta,p=e._panOffset;o.copyFrom(i.worldUp),this._atTheBack=o.y<=0,_.subtract(i.position,a,o),n.setFromVec3(o,this._atTheBack),n.theta+=c.theta,n.phi+=c.phi,n.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,n.theta)),n.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,n.phi)),n.makeSafe(),this._scale!==1&&(this._zoomFrag=n.radius*(this._scale-1)),n.radius+=this._zoomFrag,n.radius=Math.max(this.minDistance,Math.min(this.maxDistance,n.radius)),this._atTheBack=n.setToVec3(o),_.add(a.add(p),o,i.worldPosition),i.lookAt(a,o.copyFrom(this.up).scale(this._atTheBack?-1:1)),this._zoomFrag=0,this._scale=1,c.set(0,0,0),p.set(0,0,0)},x(r,[{key:"enableKeys",get:function(){return this._enableKeys},set:function(e){if(this._enableKeys!==e){this._enableKeys=e;var i=this.inputDevices;if(e)i.push(g);else for(var a=i.length-1;a>=0;a--)if(i[a]===g){i.splice(a,1);break}}}},{key:"up",get:function(){return this._up},set:function(e){this._up.copyFrom(e),this._spherical.setYAxis(e),this._atTheBack=!1}},{key:"target",get:function(){return this._target},set:function(e){this._target.copyFrom(e),this._atTheBack=!1}},{key:"enableRotate",get:function(){return(this._enableHandler&s.ROTATE)!==0},set:function(e){e?this._enableHandler|=s.ROTATE:this._enableHandler&=~s.ROTATE}},{key:"enableZoom",get:function(){return(this._enableHandler&s.ZOOM)!==0},set:function(e){e?this._enableHandler|=s.ZOOM:this._enableHandler&=~s.ZOOM}},{key:"enablePan",get:function(){return(this._enableHandler&s.PAN)!==0},set:function(e){e?this._enableHandler|=s.PAN:this._enableHandler&=~s.PAN}}]),r}(P);export{H as O};
