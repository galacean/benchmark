import"./modulepreload-polyfill.c7c6310f.js";import{C as D,V as m,f as z,L as R,W as S,M as O,P as x,b as T,H,a5 as F}from"./module.a644fe30.js";import{C as c,a as g,b as E,c as C,S as y}from"./index.f67971e6.js";function P(a,n){for(var h=0;h<n.length;h++){var t=n[h];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}}function I(a,n,h){return n&&P(a.prototype,n),h&&P(a,h),a}function b(a,n){return b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},b(a,n)}function B(a,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(n&&n.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),n&&b(a,n)}var L=function(a){B(n,a);function n(){var t;return t=a.apply(this,arguments)||this,t.inputDevices=[g,E,C],t.autoRotate=!1,t.autoRotateSpeed=Math.PI,t.enableDamping=!0,t.rotateSpeed=1,t.zoomSpeed=1,t.keyPanSpeed=7,t.dampingFactor=.1,t.zoomFactor=.2,t.minDistance=.1,t.maxDistance=1/0,t.minZoom=0,t.maxZoom=1/0,t.minPolarAngle=1/180*Math.PI,t.maxPolarAngle=179/180*Math.PI,t.minAzimuthAngle=-1/0,t.maxAzimuthAngle=1/0,t._enableKeys=!0,t._up=new m(0,1,0),t._target=new m,t._atTheBack=!1,t._spherical=new y,t._sphericalDelta=new y,t._sphericalDump=new y,t._zoomFrag=0,t._scale=1,t._panOffset=new m,t._tempVec3=new m,t._enableHandler=c.All,t}var h=n.prototype;return h.onAwake=function(){var e=this,s=e.engine,i=e.entity;this.canvas=s.canvas,this.input=s.inputManager,this.camera=i.getComponent(D),this.cameraTransform=i.transform,this._spherical.setYAxis(this._up),this._atTheBack=!1},h.onLateUpdate=function(e){this._updateInputDelta(e),this._updateTransform()},h._updateInputDelta=function(e){for(var s=c.None,i=this,o=i._tempVec3,r=i._enableHandler,l=this,p=l.inputDevices,k=l.input,_=p.length-1;_>=0;_--){var A=p[_],u=A.onUpdateHandler(k);if(u&r)switch(s|=u,A.onUpdateDelta(this,o),u){case c.ROTATE:this._rotate(o);break;case c.ZOOM:this._zoom(o);break;case c.PAN:this._pan(o);break}}var v=this,M=v._sphericalDump,d=v._sphericalDelta;if(this.enableDamping&&(r&c.ZOOM&&s^c.ZOOM&&(this._zoomFrag*=1-this.zoomFactor),r&c.ROTATE&&s^c.ROTATE&&(d.theta=M.theta*=1-this.dampingFactor,d.phi=M.phi*=1-this.dampingFactor)),s===c.None&&this.autoRotate){var w=this.autoRotateSpeed*e;d.theta-=w}},h._rotate=function(e){var s=2*Math.PI*e.x/this.canvas.width*this.rotateSpeed;this._sphericalDelta.theta-=s;var i=2*Math.PI*e.y/this.canvas.height*this.rotateSpeed;this._sphericalDelta.phi-=i,this.enableDamping&&(this._sphericalDump.theta=-s,this._sphericalDump.phi=-i)},h._zoom=function(e){e.y>0?this._scale/=Math.pow(.95,this.zoomSpeed):e.y<0&&(this._scale*=Math.pow(.95,this.zoomSpeed))},h._pan=function(e){var s=this.cameraTransform,i=s.worldMatrix.elements,o=this.canvas.height,r=m.distance(s.position,this.target)*(this.camera.fieldOfView/2)*(Math.PI/180),l=-2*e.x*(r/o),p=2*e.y*(r/o);this._panOffset.x+=i[0]*l+i[4]*p,this._panOffset.y+=i[1]*l+i[5]*p,this._panOffset.z+=i[2]*l+i[6]*p},h._updateTransform=function(){var e=this,s=e.cameraTransform,i=e.target,o=e._tempVec3,r=e._spherical,l=e._sphericalDelta,p=e._panOffset;o.copyFrom(s.worldUp),this._atTheBack=o.y<=0,m.subtract(s.position,i,o),r.setFromVec3(o,this._atTheBack),r.theta+=l.theta,r.phi+=l.phi,r.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,r.theta)),r.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,r.phi)),r.makeSafe(),this._scale!==1&&(this._zoomFrag=r.radius*(this._scale-1)),r.radius+=this._zoomFrag,r.radius=Math.max(this.minDistance,Math.min(this.maxDistance,r.radius)),this._atTheBack=r.setToVec3(o),m.add(i.add(p),o,s.worldPosition),s.lookAt(i,o.copyFrom(this.up).scale(this._atTheBack?-1:1)),this._zoomFrag=0,this._scale=1,l.set(0,0,0),p.set(0,0,0)},I(n,[{key:"enableKeys",get:function(){return this._enableKeys},set:function(e){if(this._enableKeys!==e){this._enableKeys=e;var s=this.inputDevices;if(e)s.push(g);else for(var i=s.length-1;i>=0;i--)if(s[i]===g){s.splice(i,1);break}}}},{key:"up",get:function(){return this._up},set:function(e){this._up.copyFrom(e),this._spherical.setYAxis(e),this._atTheBack=!1}},{key:"target",get:function(){return this._target},set:function(e){this._target.copyFrom(e),this._atTheBack=!1}},{key:"enableRotate",get:function(){return(this._enableHandler&c.ROTATE)!==0},set:function(e){e?this._enableHandler|=c.ROTATE:this._enableHandler&=~c.ROTATE}},{key:"enableZoom",get:function(){return(this._enableHandler&c.ZOOM)!==0},set:function(e){e?this._enableHandler|=c.ZOOM:this._enableHandler&=~c.ZOOM}},{key:"enablePan",get:function(){return(this._enableHandler&c.PAN)!==0},set:function(e){e?this._enableHandler|=c.PAN:this._enableHandler&=~c.PAN}}]),n}(z);R.enable();function f(a,n){return Math.random()*(n-a)+a}S.create({canvas:"canvas",graphicDeviceOptions:{powerPreference:"high-performance"}}).then(a=>{a.canvas.resizeByClientSize();const n=a.sceneManager.activeScene.createRootEntity(),h=n.createChild("camera");h.addComponent(D),h.transform.setPosition(0,6,40),h.addComponent(L);const e=n.createChild().addComponent(O),s=new x(a);e.mesh=T.createPlane(a,1e3,1e3),e.setMaterial(s);const i=10;for(let o=0;o<i;o++){const r=n.createChild("light"+o);r.transform.setPosition(f(-5,5),f(1,4),f(-5,5));const l=r.addComponent(H);l.distance=5,l.color.set(f(0,1),f(0,1),f(0,1),1);const p=r.addComponent(O);p.mesh=T.createSphere(a,.3,32),p.setMaterial(new F(a))}a.resourceManager.load("https://mdn.alipayobjects.com/oasis_be/afts/file/A*nceKQadLab8AAAAAAAAAAAAADkp5AQ/DamagedHelmet.glb").then(o=>{const r=n.createChild(""),l=o.instantiateSceneRoot();l.transform.setPosition(0,1,0),r.addChild(l)}),a.run()});
