import"./modulepreload-polyfill.c7c6310f.js";import{V as A,P as T,S as G,C as L,A as O,D as q,G as D,ah as P,w as W,W as j}from"./three.module.9a85ab34.js";import{O as k}from"./OrbitControls.9b96d4a1.js";import{S as E}from"./stats.module.9f3638b7.js";async function F(){if(!("Ammo"in window)){console.error("AmmoPhysics: Couldn't find Ammo.js");return}const t=await Ammo(),d=60,o=new t.btDefaultCollisionConfiguration,i=new t.btCollisionDispatcher(o),m=new t.btDbvtBroadphase,g=new t.btSequentialImpulseConstraintSolver,b=new t.btDiscreteDynamicsWorld(i,m,g,o);b.setGravity(new t.btVector3(0,-9.8,0));const c=new t.btTransform;function M(n){const e=n.parameters;if(n.type==="BoxGeometry"){const a=e.width!==void 0?e.width/2:.5,r=e.height!==void 0?e.height/2:.5,s=e.depth!==void 0?e.depth/2:.5,l=new t.btBoxShape(new t.btVector3(a,r,s));return l.setMargin(.05),l}else if(n.type==="SphereGeometry"||n.type==="IcosahedronGeometry"){const a=e.radius!==void 0?e.radius:1,r=new t.btSphereShape(a);return r.setMargin(.05),r}return null}const f=[],u=new WeakMap;function z(n){n.traverse(function(e){if(e.isMesh){const a=e.userData.physics;a&&V(e,a.mass)}})}function V(n,e=0){const a=M(n.geometry);a!==null&&(n.isInstancedMesh?v(n,e,a):n.isMesh&&p(n,e,a))}function p(n,e,a){const r=n.position,s=n.quaternion,l=new t.btTransform;l.setIdentity(),l.setOrigin(new t.btVector3(r.x,r.y,r.z)),l.setRotation(new t.btQuaternion(s.x,s.y,s.z,s.w));const I=new t.btDefaultMotionState(l),w=new t.btVector3(0,0,0);a.calculateLocalInertia(e,w);const y=new t.btRigidBodyConstructionInfo(e,I,a,w),x=new t.btRigidBody(y);b.addRigidBody(x),e>0&&(f.push(n),u.set(n,x))}function v(n,e,a){const r=n.instanceMatrix.array,s=[];for(let l=0;l<n.count;l++){const I=l*16,w=new t.btTransform;w.setFromOpenGLMatrix(r.slice(I,I+16));const y=new t.btDefaultMotionState(w),x=new t.btVector3(0,0,0);a.calculateLocalInertia(e,x);const R=new t.btRigidBodyConstructionInfo(e,y,a,x),B=new t.btRigidBody(R);b.addRigidBody(B),s.push(B)}e>0&&(f.push(n),u.set(n,s))}function S(n,e,a=0){if(n.isInstancedMesh){const s=u.get(n)[a];s.setAngularVelocity(new t.btVector3(0,0,0)),s.setLinearVelocity(new t.btVector3(0,0,0)),c.setIdentity(),c.setOrigin(new t.btVector3(e.x,e.y,e.z)),s.setWorldTransform(c)}else if(n.isMesh){const r=u.get(n);r.setAngularVelocity(new t.btVector3(0,0,0)),r.setLinearVelocity(new t.btVector3(0,0,0)),c.setIdentity(),c.setOrigin(new t.btVector3(e.x,e.y,e.z)),r.setWorldTransform(c)}}let h=0;function C(){const n=performance.now();if(h>0){const e=(n-h)/1e3;b.stepSimulation(e,10);for(let a=0,r=f.length;a<r;a++){const s=f[a];if(s.isInstancedMesh){const l=s.instanceMatrix.array,I=u.get(s);for(let w=0;w<I.length;w++){I[w].getMotionState().getWorldTransform(c);const R=c.getOrigin(),B=c.getRotation();H(R,B,l,w*16)}s.instanceMatrix.needsUpdate=!0,s.computeBoundingSphere()}else if(s.isMesh){u.get(s).getMotionState().getWorldTransform(c);const w=c.getOrigin(),y=c.getRotation();s.position.set(w.x(),w.y(),w.z()),s.quaternion.set(y.x(),y.y(),y.z(),y.w())}}}h=n}return setInterval(C,1e3/d),{addScene:z,addMesh:V,setMeshPosition:S}}function H(t,d,o,i){const m=d.x(),g=d.y(),b=d.z(),c=d.w(),M=m+m,f=g+g,u=b+b,z=m*M,V=m*f,p=m*u,v=g*f,S=g*u,h=b*u,C=c*M,n=c*f,e=c*u;o[i+0]=1-(v+h),o[i+1]=V+e,o[i+2]=p-n,o[i+3]=0,o[i+4]=V-e,o[i+5]=1-(z+h),o[i+6]=S+C,o[i+7]=0,o[i+8]=p+n,o[i+9]=S-C,o[i+10]=1-(z+v),o[i+11]=0,o[i+12]=t.x(),o[i+13]=t.y(),o[i+14]=t.z(),o[i+15]=1}const Q=new Promise((t,d)=>{const o=document.createElement("script");document.body.appendChild(o),o.async=!0,o.onload=t,o.onerror=d,o.src="./public/ammo.wasm.js"});Q.then(()=>{let t,d,o,i,m;g();async function g(){m=await F(),new A,t=new T(45,window.innerWidth/window.innerHeight,.1,100),t.position.set(-1,1.5,2),t.lookAt(0,0,0),d=new G,d.background=new L;var c=new O(16777215);c.color.set(new L(1,1,1)),d.add(c);const M=new q;M.position.set(-.3,1,.4),M.castShadow=!1,d.add(M);const f=new D(new P(30,1,30),new W({color:3623503}));f.position.y=-.5,f.receiveShadow=!1,d.add(f),m.addMesh(f);const u=new P(.075,.075,.075);var z=0;setInterval(()=>{z>1e3||(V(new A(Math.random()-.5,Math.random()*2+2.5,Math.random()-.5)),z++)},16);function V(S){let h=new D(u,new W({color:16777215*Math.random()}));h.castShadow=!1,h.receiveShadow=!1,d.add(h),h.position.set(S.x,S.y,S.z),m.addMesh(h,1)}const p=document.getElementById("canvas");p.width=p.clientWidth*window.devicePixelRatio,p.height=p.clientHeight*window.devicePixelRatio,o=new j({canvas:p,antialias:!0}),o.shadowMap.enabled=!1,i=new E,document.body.appendChild(i.dom);const v=new k(t,o.domElement);v.target.y=.5,v.update(),b()}function b(){requestAnimationFrame(b),o.render(d,t),i.update()}});
