import"./modulepreload-polyfill.c7c6310f.js";import{L as q,S as tt,V as l,Q as x,W as et,C as it,D as nt,b as st,A as rt,P as U,c as at,M as Q,d as j,e as ot,f as ht,B as lt,g as ct}from"./module.976fcab8.js";import{O as ut}from"./index.3458aa33.js";function b(r,s){return s!=null&&typeof Symbol<"u"&&s[Symbol.hasInstance]?!!s[Symbol.hasInstance](r):r instanceof s}function z(r,s){for(var i=0;i<s.length;i++){var t=s[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function Y(r,s,i){return s&&z(r.prototype,s),i&&z(r,i),r}var E=0;function dt(){var r=XMLHttpRequest.prototype.send,s=new Map;function i(t,e){s.get(t)==null&&(s.set(t,e),E+=e)}XMLHttpRequest.prototype.send=function(t){this.addEventListener("load",function(){var n=0;this.responseType===""||this.responseType==="text"?n=new Blob([JSON.stringify(this.responseText)]).size:b(this.response,Blob)?n=this.response.size:b(this.response,ArrayBuffer)?n=this.response.byteLength:this.responseType==="json"&&(n=new Blob([JSON.stringify(this.response)]).size),i(this.responseURL,n)},!1),r.call(this,t);var e=Object.getOwnPropertyDescriptor(Image.prototype,"src").set;this.originalImageSrc=e,Object.defineProperty(Image.prototype,"src",{set:function(a){var o=this;fetch(a).then(function(h){h.ok&&h.blob().then(function(c){i(o.responseURL,c.size)})}),e.call(this,a)}})}}var pt=function(){function r(){this._hooked=!1,this._hooked=!0}var s=r.prototype;return s.reset=function(){E=0},s.release=function(){this._hooked&&(XMLHttpRequest.prototype.send=this._originalSend,Object.defineProperty(Image.prototype,"src",{set:function(e){this.src.call(this,e)}})),this._hooked=!1},Y(r,[{key:"size",get:function(){return _t(E/1024/1024)}}]),r}();function _t(r){return Number(r).toFixed(Math.max(6-r.toString().split(".")[0].length,0))}function S(){for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];var t;(t=q).info.apply(t,[].concat(["\u{1F680} [galacean engine--stats]"],s))}function X(){for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];var t;(t=q).error.apply(t,[].concat(["\u{1F680} [galacean engine-stats]"],s))}var ft=function(){function r(i){this.drawCall=0,this.triangles=0,this.lines=0,this.points=0,this.realDrawElements=i.drawElements,this.realDrawArrays=i.drawArrays,i.drawElements=this.hookedDrawElements.bind(this),i.drawArrays=this.hookedDrawArrays.bind(this);var t=this.hasInstancedFunction(i);if(t)this.realDrawElementsInstanced=i.drawElementsInstanced,this.realDrawArraysInstanced=i.drawArraysInstanced,i.drawElementsInstanced=this.hookedDrawElementsInstanced.bind(this),i.drawArraysInstanced=this.hookedDrawArraysInstanced.bind(this);else{var e=i.getExtension("ANGLE_instanced_arrays");e?(this.realDrawElementsInstanced=e.drawElementsInstancedANGLE,this.realDrawArraysInstanced=e.drawArraysInstancedANGLE,e.drawElementsInstancedANGLE=this.hookedDrawElementsInstanced.bind(this),e.drawArraysInstancedANGLE=this.hookedDrawArraysInstanced.bind(this)):X("GPU Instancing is not supported.")}this.hooked=!0,this.gl=i,S("DrawCall is hooked.")}var s=r.prototype;return s.hasInstancedFunction=function(t){return b(t,WebGL2RenderingContext)||t.hasOwnProperty("drawElementsInstanced")&&t.hasOwnProperty("drawArraysInstanced")},s.hookedDrawElements=function(t,e,n,a){this.realDrawElements.call(this.gl,t,e,n,a),this.update(e,t)},s.hookedDrawArrays=function(t,e,n){this.realDrawArrays.call(this.gl,t,e,n),this.update(n,t)},s.hookedDrawElementsInstanced=function(t,e,n,a,o){this.realDrawElementsInstanced.call(this.gl,t,e,n,a,o),this.update(e,t)},s.hookedDrawArraysInstanced=function(t,e,n,a){this.realDrawArraysInstanced.call(this.gl,t,e,n,a),this.update(n,t)},s.update=function(t,e){var n=this.gl;switch(this.drawCall++,e){case n.TRIANGLES:this.triangles+=t/3;break;case n.TRIANGLE_STRIP:case n.TRIANGLE_FAN:this.triangles+=t-2;break;case n.LINES:this.lines+=t/2;break;case n.LINE_STRIP:this.lines+=t-1;break;case n.LINE_LOOP:this.lines+=t;break;case n.POINTS:this.points+=t;break;default:X("Unknown draw mode: "+e);break}},s.reset=function(){this.drawCall=0,this.triangles=0,this.lines=0,this.points=0},s.release=function(){if(this.hooked){var t=this.gl;t.drawElements=this.realDrawElements,t.drawArrays=this.realDrawArrays;var e=this.hasInstancedFunction(t);if(e)t.drawElementsInstanced=this.realDrawElementsInstanced,t.drawArraysInstanced=this.realDrawArraysInstanced;else{var n=t.getExtension("ANGLE_instanced_arrays");n&&(n.drawElementsInstancedANGLE=this.realDrawElementsInstanced,n.drawArraysInstancedANGLE=this.realDrawArraysInstanced)}}this.hooked=!1},r}(),yt=function(){function r(i){this.shaders=0,this.realAttachShader=i.attachShader,this.realDetachShader=i.detachShader,i.attachShader=this.hookedAttachShader.bind(this),i.detachShader=this.hookedDetachShader.bind(this),this.hooked=!0,this.gl=i,S("Shader is hooked.")}var s=r.prototype;return s.hookedAttachShader=function(t,e){this.realAttachShader.call(this.gl,t,e),this.shaders++,S("AttachShader:",e,"shaders: "+this.shaders)},s.hookedDetachShader=function(t,e){this.realDetachShader.call(this.gl,t,e),this.shaders--,S("DetachShader. shaders: "+this.shaders)},s.reset=function(){this.shaders=0},s.release=function(){this.hooked&&(this.gl.attachShader=this.realAttachShader,this.gl.detachShader=this.realDetachShader),this.hooked=!1},r}(),xt=function(){function r(i){this.textures=0,this.realCreateTexture=i.createTexture,this.realDeleteTexture=i.deleteTexture,i.createTexture=this.hookedCreateTexture.bind(this),i.deleteTexture=this.hookedDeleteTexture.bind(this),this.hooked=!0,this.gl=i,S("Texture is hooked.")}var s=r.prototype;return s.hookedCreateTexture=function(){var t=this.realCreateTexture.call(this.gl);return this.textures++,S("CreateTexture:",t,"textures: "+this.textures),t},s.hookedDeleteTexture=function(t){this.realDeleteTexture.call(this.gl,t),this.textures--,S("DeleteTexture. textures: "+this.textures)},s.reset=function(){this.textures=0},s.release=function(){this.hooked&&(this.gl.createTexture=this.realCreateTexture,this.gl.deleteTexture=this.realDeleteTexture),this.hooked=!1},r}(),mt=function(){function r(i){this.samplingFrames=60,this.samplingIndex=0,this.updateCounter=0,this.updateTime=0,this.gl=i,this.hook(i)}var s=r.prototype;return s.hook=function(t){this.drawCallHook=new ft(t),this.textureHook=new xt(t),this.shaderHook=new yt(t),this.requestHook=new pt},s.reset=function(){this.drawCallHook&&this.drawCallHook.reset()},s.release=function(){this.drawCallHook&&this.drawCallHook.release(),this.textureHook&&this.textureHook.release(),this.shaderHook&&this.shaderHook.release()},s.update=function(){this.updateCounter++;var t=performance.now();if(!(t-this.updateTime<1e3)){if(this.samplingIndex!==this.samplingFrames){this.reset(),this.samplingIndex++;return}this.samplingIndex=0;var e={fps:Math.round(this.updateCounter*1e3/(t-this.updateTime)),memory:performance.memory&&performance.memory.usedJSHeapSize/1048576>>0,drawCall:this.drawCallHook.drawCall,triangles:this.drawCallHook.triangles,lines:this.drawCallHook.lines,points:this.drawCallHook.points,textures:this.textureHook.textures,size:this.requestHook.size,shaders:this.shaderHook.shaders,webglContext:window.hasOwnProperty("WebGL2RenderingContext")&&b(this.gl,WebGL2RenderingContext)?"2.0":"1.0"};return this.reset(),this.updateCounter=0,this.updateTime=t,e}},r}(),gt=`
  <dl>
    <dt>FPS</dt>
    <dd>0</dd>
    <dt>Memory <span class="unit">(MB)</span></dt>
    <dd>0</dd>
    <dt>DrawCall</dt>
    <dd>0</dd>
    <dt>Triangles</dt>
    <dd>0</dd>
    <dt>Textures</dt>
    <dd>0</dd>
    <dt>Shaders</dt>
    <dd>0</dd>
    <dt>Network Size <span class="unit">(MB)</span></dt>
    <dd>0</dd>
    <dt>WebGL</dt>
    <dd></dd>
  </dl>
`,vt=`
  .gl-perf {
    pointer-events: none;
    user-select: none;
    position: fixed;
    top: 0;
    left: 0;
    padding: `+10/7.5+"vh "+10/7.5+"vh 0 "+10/7.5+`vh;
    background: rgba(0, 0, 0, 0.3);
    color: #fff;
    font: `+10/7.5+`vh arial;
  }

  .gl-perf dl,
  .gl-perf dt,
  .gl-perf dd {
    padding: 0;
    margin: 0;
  }

  .gl-perf dt {
    color: #fff;
    text-shadow: #000 0 0 1px;
  }

  .gl-perf dt .unit{
    font-size: `+10/7.5+`vh;
  }

  .gl-perf dd {
    font-size: `+20/7.5+`vh;
    padding: `+10/7.5+"vh 0 "+10/7.5+`vh;
  }
`,St=function(){function r(i){this.core=new mt(i),this.items=[],this.items=["fps","memory","drawCall","triangles","textures","shaders","size","webglContext"],this.createContainer(),this.update=this.update.bind(this)}var s=r.prototype;return s.createContainer=function(){var t=document.createElement("div");t.classList.add("gl-perf"),t.innerHTML=gt,t.appendChild(this.createStyle()),document.body.appendChild(t),this.doms=Array.prototype.slice.apply(t.querySelectorAll("dd")),this.container=t},s.createStyle=function(){var t=document.createElement("style");return t.type="text/css",t.appendChild(document.createTextNode(vt)),t},s.update=function(){var t=this.core.update();if(t)for(var e,n=function(h,c){var u=e.doms[h],d=e.items[h],m=t[d]||0;requestAnimationFrame(function(){u.innerText=m})},a=0,o=this.items.length;a<o;a++)e=this,n(a,o)},s.reset=function(){this.core.reset()},s.release=function(){this.core.release()},s.destroy=function(){this.release(),document.body.removeChild(this.container)},r}();function D(r,s){return D=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},D(r,s)}function wt(r,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&D(r,s)}var Ct=function(r){wt(s,r);function s(){return r.apply(this,arguments)}var i=s.prototype;return i.onBeginRender=function(e){this.camera=e,this.monitor||this._setupMonitor()},i.onEndRender=function(e){this.monitor&&this.monitor.update()},i._setupMonitor=function(){var e=this.camera.engine._hardwareRenderer.gl;e&&(this.monitor=new St(e))},s.hookRequest=function(){dt()},Y(s,[{key:"enabled",set:function(e){e?this._setupMonitor():this.monitor.destroy()}}]),s}(tt);function A(r,s){return s!=null&&typeof Symbol<"u"&&s[Symbol.hasInstance]?!!s[Symbol.hasInstance](r):r instanceof s}function k(r,s){return k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},k(r,s)}function g(r,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),s&&k(r,s)}var K=function(){function r(i){i===void 0&&(i=0),this.length=0,this._elements=new Array(i)}var s=r.prototype;return s.add=function(t){this.length===this._elements.length?this._elements.push(t):this._elements[this.length]=t,this.length++},s.delete=function(t){var e=this._elements.indexOf(t);this.deleteByIndex(e)},s.get=function(t){if(t>=this.length)throw"Index is out of range.";return this._elements[t]},s.deleteByIndex=function(t){var e=this._elements,n=null,a=this.length-1;return t!==a&&(n=e[a],e[t]=n),this.length--,n},s.garbageCollection=function(){this._elements.length=this.length},r}(),G;(function(r){r[r.SIMULATION_SHAPE=1]="SIMULATION_SHAPE",r[r.SCENE_QUERY_SHAPE=2]="SCENE_QUERY_SHAPE",r[r.TRIGGER_SHAPE=4]="TRIGGER_SHAPE"})(G||(G={}));var y=function(){function r(i){this._controllers=new K,this._worldScale=new l(1,1,1),this._position=new l,this._rotation=null,this._axis=null,this._physXRotation=new x,this._shapeFlags=3,this._physXPhysics=i}var s=r.prototype;return s.setRotation=function(t){this._rotation=t,x.rotationYawPitchRoll(t.x,t.y,t.z,this._physXRotation),this._axis&&x.multiply(this._physXRotation,this._axis,this._physXRotation),this._physXRotation.normalize(),this._setLocalPose()},s.setPosition=function(t){t!==this._position&&this._position.copyFrom(t);for(var e=this._controllers,n=0,a=e.length;n<a;n++)e.get(n)._updateShapePosition(this._position,this._worldScale);this._setLocalPose()},s.setWorldScale=function(t){this._worldScale.copyFrom(t),this._setLocalPose();for(var e=this._controllers,n=0,a=e.length;n<a;n++)e.get(n)._updateShapePosition(this._position,this._worldScale)},s.setContactOffset=function(t){this._pxShape.setContactOffset(t);for(var e=this._controllers,n=0,a=e.length;n<a;n++)e.get(n)._pxController.setContactOffset(t)},s.setMaterial=function(t){this._pxMaterial=t._pxMaterial,this._pxShape.setMaterial(this._pxMaterial)},s.setIsTrigger=function(t){this._modifyFlag(1,!t),this._modifyFlag(4,t),this._setShapeFlags(this._shapeFlags)},s.destroy=function(){this._pxShape.release()},s._setShapeFlags=function(t){this._shapeFlags=t,this._pxShape.setFlags(new this._physXPhysics._physX.PxShapeFlags(this._shapeFlags))},s._setLocalPose=function(){var t=r.transform;l.multiply(this._position,this._worldScale,t.translation),t.rotation=this._physXRotation,this._pxShape.setLocalPose(t)},s._initialize=function(t,e){this._id=e,this._pxMaterial=t._pxMaterial,this._pxShape=this._physXPhysics._pxPhysics.createShape(this._pxGeometry,t._pxMaterial,!0,new this._physXPhysics._physX.PxShapeFlags(this._shapeFlags)),this._pxShape.setUUID(e)},s._modifyFlag=function(t,e){this._shapeFlags=e?this._shapeFlags|t:this._shapeFlags&~t},r}();(function(){y.halfSqrt=.70710678118655})();(function(){y.transform={translation:new l,rotation:null}})();var I=function(r){g(s,r);function s(t,e,n,a){var o;o=r.call(this,t)||this,o._halfSize=new l,o._sizeScale=new l(1,1,1);var h=o._halfSize;return h.set(n.x*.5,n.y*.5,n.z*.5),o._pxGeometry=new t._physX.PxBoxGeometry(h.x,h.y,h.z),o._initialize(a,e),o._setLocalPose(),o}var i=s.prototype;return i.setSize=function(e){var n=this._halfSize,a=s._tempHalfExtents;n.set(e.x*.5,e.y*.5,e.z*.5),l.multiply(n,this._sizeScale,a),this._pxGeometry.halfExtents=a,this._pxShape.setGeometry(this._pxGeometry),this._updateController(a)},i.setWorldScale=function(e){r.prototype.setWorldScale.call(this,e),this._sizeScale.set(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));var n=s._tempHalfExtents;l.multiply(this._halfSize,this._sizeScale,n),this._pxGeometry.halfExtents=n,this._pxShape.setGeometry(this._pxGeometry),this._updateController(n)},i._updateController=function(e){for(var n=this._controllers,a=0,o=n.length;a<o;a++){var h=n.get(a)._pxController;h.setHalfHeight(e.x),h.setHalfSideExtent(e.y),h.setHalfForwardExtent(e.z)}},s}(y);(function(){I._tempHalfExtents=new l})();var $=function(r){g(s,r);function s(t,e,n,a,o){var h;return h=r.call(this,t)||this,h._upAxis=1,h._sizeScale=new l(1,1,1),h._radius=n,h._halfHeight=a*.5,h._axis=new x(0,0,y.halfSqrt,y.halfSqrt),h._physXRotation.copyFrom(h._axis),h._pxGeometry=new t._physX.PxCapsuleGeometry(h._radius,h._halfHeight),h._initialize(o,e),h._setLocalPose(),h}var i=s.prototype;return i.setRadius=function(e){this._radius=e;var n=this._sizeScale;switch(this._upAxis){case 0:this._pxGeometry.radius=this._radius*Math.max(n.y,n.z);break;case 1:this._pxGeometry.radius=this._radius*Math.max(n.x,n.z);break;case 2:this._pxGeometry.radius=this._radius*Math.max(n.x,n.y);break}this._pxShape.setGeometry(this._pxGeometry);for(var a=this._pxGeometry.radius,o=this._controllers,h=0,c=o.length;h<c;h++)o.get(h)._pxController.setRadius(a)},i.setHeight=function(e){this._halfHeight=e*.5;var n=this._sizeScale;switch(this._upAxis){case 0:this._pxGeometry.halfHeight=this._halfHeight*n.x;break;case 1:this._pxGeometry.halfHeight=this._halfHeight*n.y;break;case 2:this._pxGeometry.halfHeight=this._halfHeight*n.z;break}this._pxShape.setGeometry(this._pxGeometry);for(var a=this._pxGeometry.halfHeight*2,o=this._controllers,h=0,c=o.length;h<c;h++)o.get(h)._pxController.setHeight(a)},i.setUpAxis=function(e){var n=this,a=n._rotation,o=n._axis,h=n._physXRotation;switch(this._upAxis=e,this._upAxis){case 0:o.set(0,0,0,1);break;case 1:o.set(0,0,y.halfSqrt,y.halfSqrt);break;case 2:o.set(0,y.halfSqrt,0,y.halfSqrt);break}a?(x.rotationYawPitchRoll(a.x,a.y,a.z,h),x.multiply(h,o,h)):h.copyFrom(o),this._setLocalPose()},i.setWorldScale=function(e){r.prototype.setWorldScale.call(this,e);var n=this._sizeScale.set(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),a=this._pxGeometry;switch(this._upAxis){case 0:a.radius=this._radius*Math.max(n.y,n.z),a.halfHeight=this._halfHeight*n.x;break;case 1:a.radius=this._radius*Math.max(n.x,n.z),a.halfHeight=this._halfHeight*n.y;break;case 2:a.radius=this._radius*Math.max(n.x,n.y),a.halfHeight=this._halfHeight*n.z;break}this._pxShape.setGeometry(a);for(var o=a.radius,h=a.halfHeight*2,c=this._controllers,u=0,d=c.length;u<d;u++){var m=c.get(u)._pxController;m.setRadius(o),m.setHeight(h)}},s}(y),B;(function(r){r[r.X=0]="X",r[r.Y=1]="Y",r[r.Z=2]="Z"})(B||(B={}));var Z=function(){function r(i){this._shapeScaledPosition=new l,this._worldPosition=null,this._physXPhysics=i}var s=r.prototype;return s.move=function(t,e,n){var a,o;return(o=(a=this._pxController)==null?void 0:a.move(t,e,n))!=null?o:0},s.setWorldPosition=function(t){this._worldPosition=t,this._updateNativePosition()},s.getWorldPosition=function(t){this._pxController&&(t.copyFrom(this._pxController.getPosition()),t.subtract(this._shapeScaledPosition))},s.setStepOffset=function(t){var e;(e=this._pxController)==null||e.setStepOffset(t)},s.setNonWalkableMode=function(t){var e;(e=this._pxController)==null||e.setNonWalkableMode(t)},s.setUpDirection=function(t){var e;(e=this._pxController)==null||e.setUpDirection(t)},s.setSlopeLimit=function(t){var e;(e=this._pxController)==null||e.setSlopeLimit(t)},s.addShape=function(t){this._pxManager&&this._createPXController(this._pxManager,t),this._shape=t,t._controllers.add(this)},s.removeShape=function(t){this._destroyPXController(),this._shape=null,t._controllers.delete(this)},s.destroy=function(){this._destroyPXController()},s._createPXController=function(t,e){var n;if(A(e,I))n=new this._physXPhysics._physX.PxBoxControllerDesc,n.halfHeight=e._halfSize.x,n.halfSideExtent=e._halfSize.y,n.halfForwardExtent=e._halfSize.z;else if(A(e,$))n=new this._physXPhysics._physX.PxCapsuleControllerDesc,n.radius=e._radius,n.height=e._halfHeight*2,n.climbingMode=1;else throw"unsupported shape type";n.setMaterial(e._pxMaterial),this._pxController=t._getControllerManager().createController(n),this._pxController.setUUID(e._id)},s._destroyPXController=function(){this._pxController&&(this._pxController.release(),this._pxController=null)},s._updateShapePosition=function(t,e){l.multiply(t,e,this._shapeScaledPosition),this._updateNativePosition()},s._updateNativePosition=function(){var t=this._worldPosition;this._pxController&&t&&(l.add(t,this._shapeScaledPosition,r._tempVec),this._pxController.setPosition(r._tempVec))},r}();(function(){Z._tempVec=new l})();var T=function(){function r(i){this._physXPhysics=i}var s=r.prototype;return s.addShape=function(t){this._pxActor.attachShape(t._pxShape)},s.removeShape=function(t){this._pxActor.detachShape(t._pxShape,!0)},s.setWorldTransform=function(t,e){this._pxActor.setGlobalPose(this._transform(t,e),!0)},s.getWorldTransform=function(t,e){var n=this._pxActor.getGlobalPose();t.set(n.translation.x,n.translation.y,n.translation.z),e.set(n.rotation.x,n.rotation.y,n.rotation.z,n.rotation.w)},s.destroy=function(){this._pxActor.release()},s._transform=function(t,e){var n=r._tempTransform;return n.translation=t,n.rotation=e.normalize(),n},r}();(function(){T._tempTransform={translation:null,rotation:null}})();var J;(function(r){r[r.Discrete=0]="Discrete",r[r.Continuous=1]="Continuous",r[r.ContinuousDynamic=2]="ContinuousDynamic",r[r.ContinuousSpeculative=3]="ContinuousSpeculative"})(J||(J={}));var R=function(r){g(s,r);function s(t,e,n){var a;a=r.call(this,t)||this;var o=a._transform(e,n);return a._pxActor=t._pxPhysics.createRigidDynamic(o),a}var i=s.prototype;return i.setLinearDamping=function(e){this._pxActor.setLinearDamping(e)},i.setAngularDamping=function(e){this._pxActor.setAngularDamping(e)},i.setLinearVelocity=function(e){this._pxActor.setLinearVelocity(e,!0)},i.setAngularVelocity=function(e){this._pxActor.setAngularVelocity(e,!0)},i.setMass=function(e){this._pxActor.setMass(e)},i.setCenterOfMass=function(e){this._pxActor.setCMassLocalPose(e)},i.setInertiaTensor=function(e){this._pxActor.setMassSpaceInertiaTensor(e)},i.setMaxAngularVelocity=function(e){this._pxActor.setMaxAngularVelocity(e)},i.setMaxDepenetrationVelocity=function(e){this._pxActor.setMaxDepenetrationVelocity(e)},i.setSleepThreshold=function(e){this._pxActor.setSleepThreshold(e)},i.setSolverIterations=function(e){this._pxActor.setSolverIterationCounts(e,1)},i.setCollisionDetectionMode=function(e){switch(e){case 1:this._pxActor.setRigidBodyFlag(this._physXPhysics._physX.PxRigidBodyFlag.eENABLE_CCD,!0);break;case 2:this._pxActor.setRigidBodyFlag(this._physXPhysics._physX.PxRigidBodyFlag.eENABLE_CCD_FRICTION,!0);break;case 3:this._pxActor.setRigidBodyFlag(this._physXPhysics._physX.PxRigidBodyFlag.eENABLE_SPECULATIVE_CCD,!0);break;case 0:var n=this._physXPhysics._physX;this._pxActor.setRigidBodyFlag(n.PxRigidBodyFlag.eENABLE_CCD,!1),this._pxActor.setRigidBodyFlag(n.PxRigidBodyFlag.eENABLE_CCD_FRICTION,!1),this._pxActor.setRigidBodyFlag(n.PxRigidBodyFlag.eENABLE_SPECULATIVE_CCD,!1);break}},i.setIsKinematic=function(e){e?this._pxActor.setRigidBodyFlag(this._physXPhysics._physX.PxRigidBodyFlag.eKINEMATIC,!0):this._pxActor.setRigidBodyFlag(this._physXPhysics._physX.PxRigidBodyFlag.eKINEMATIC,!1)},i.setConstraints=function(e){this._pxActor.setRigidDynamicLockFlags(e)},i.addForce=function(e){this._pxActor.addForce({x:e.x,y:e.y,z:e.z})},i.addTorque=function(e){this._pxActor.addTorque({x:e.x,y:e.y,z:e.z})},i.move=function(e,n){if(n){this._pxActor.setKinematicTarget(e,n);return}var a=s._tempTranslation,o=s._tempRotation;this.getWorldTransform(a,o),A(e,l)?this._pxActor.setKinematicTarget(e,o):this._pxActor.setKinematicTarget(a,e)},i.sleep=function(){return this._pxActor.putToSleep()},i.wakeUp=function(){return this._pxActor.wakeUp()},s}(T);(function(){R._tempTranslation=new l})();(function(){R._tempRotation=new x})();var Pt=function(){this._eventMap={}},At=function(){function r(i,t,e,n,a,o){this._physXPhysics=i;var h=i._pxPhysics.createMaterial(t,e,n);h.setFrictionCombineMode(a),h.setRestitutionCombineMode(o),this._pxMaterial=h}var s=r.prototype;return s.setBounciness=function(t){this._pxMaterial.setRestitution(t)},s.setDynamicFriction=function(t){this._pxMaterial.setDynamicFriction(t)},s.setStaticFriction=function(t){this._pxMaterial.setStaticFriction(t)},s.setBounceCombine=function(t){this._pxMaterial.setRestitutionCombineMode(t)},s.setFrictionCombine=function(t){this._pxMaterial.setFrictionCombineMode(t)},s.destroy=function(){this._pxMaterial.release()},r}(),N;(function(r){r[r.Average=0]="Average",r[r.Minimum=1]="Minimum",r[r.Multiply=2]="Multiply",r[r.Maximum=3]="Maximum"})(N||(N={}));var F=function(){function r(i,t,e,n,a,o,h,c){var u=this;this._pxControllerManager=null,this._currentEvents=new K,this._eventPool=[],this._physXPhysics=i,this._physXManager=t;var d=i._physX;this._pxRaycastHit=new d.PxRaycastHit,this._pxFilterData=new d.PxQueryFilterData,this._pxFilterData.flags=new d.PxQueryFlags(7),this._onContactEnter=e,this._onContactExit=n,this._onContactStay=a,this._onTriggerEnter=o,this._onTriggerExit=h,this._onTriggerStay=c;var m={onContactBegin:function(_,f){u._onContactEnter(_,f)},onContactEnd:function(_,f){u._onContactExit(_,f)},onContactPersist:function(_,f){u._onContactStay(_,f)},onTriggerBegin:function(_,f){var C=_<f?u._getTrigger(_,f):u._getTrigger(f,_);C.state=0,u._currentEvents.add(C)},onTriggerEnd:function(_,f){var C;if(_<f){var L=u._physXManager._eventMap[_];C=L[f],L[f]=void 0}else{var H=u._physXManager._eventMap[f];C=H[_],H[_]=void 0}C.state=2}},w=i._pxPhysics,P=d.PxSimulationEventCallback.implement(m),M=d.getDefaultSceneDesc(w.getTolerancesScale(),0,P);this._pxScene=w.createScene(M)}var s=r.prototype;return s.setGravity=function(t){this._pxScene.setGravity(t)},s.addColliderShape=function(t){this._physXManager._eventMap[t._id]={}},s.removeColliderShape=function(t){for(var e=this,n=e._eventPool,a=e._currentEvents,o=t._id,h=this._physXManager,c=h._eventMap,u=a.length-1;u>=0;u--){var d=a.get(u);d.index1==o?(a.deleteByIndex(u),n.push(d)):d.index2==o&&(a.deleteByIndex(u),n.push(d),c[d.index1][o]=void 0)}delete c[o]},s.addCollider=function(t){this._pxScene.addActor(t._pxActor,null)},s.removeCollider=function(t){this._pxScene.removeActor(t._pxActor,!0)},s.addCharacterController=function(t){if(!t._pxController){var e=t._shape;if(e){var n=t._pxManager;n!==this&&(n&&t._destroyPXController(),t._createPXController(this,e))}}t._pxManager=this},s.removeCharacterController=function(t){t._pxManager=null},s.update=function(t){this._simulate(t),this._fetchResults(),this._fireEvent()},s.raycast=function(t,e,n,a){var o=this,h=o._pxRaycastHit;e=Math.min(e,34e37);var c={preFilter:function(M,_,f){return n(_)?2:0},postFilter:function(M,_){}},u=this._pxScene.raycastSingle(t.origin,t.direction,e,h,this._pxFilterData,this._physXPhysics._physX.PxQueryFilterCallback.implement(c));if(u&&a!=null){var d=r._tempPosition,m=r._tempNormal,w=h.position,P=h.normal;d.set(w.x,w.y,w.z),m.set(P.x,P.y,P.z),a(h.getShape().getUUID(),h.distance,d,m)}return u},s._getControllerManager=function(){var t=this._pxControllerManager;return t===null&&(this._pxControllerManager=t=this._pxScene.createControllerManager()),t},s._simulate=function(t){this._pxScene.simulate(t,!0)},s._fetchResults=function(t){t===void 0&&(t=!0),this._pxScene.fetchResults(t)},s._getTrigger=function(t,e){var n;return this._eventPool.length?(n=this._eventPool.pop(),n.index1=t,n.index2=e):n=new bt(t,e),this._physXManager._eventMap[t][e]=n,n},s._fireEvent=function(){for(var t=this,e=t._eventPool,n=t._currentEvents,a=n.length-1;a>=0;a--){var o=n.get(a);o.state==0?(this._onTriggerEnter(o.index1,o.index2),o.state=1):o.state==1?this._onTriggerStay(o.index1,o.index2):o.state==2&&(this._onTriggerExit(o.index1,o.index2),n.deleteByIndex(a),e.push(o))}},r}();(function(){F._tempPosition=new l})();(function(){F._tempNormal=new l})();var O;(function(r){r[r.STATIC=1]="STATIC",r[r.DYNAMIC=2]="DYNAMIC",r[r.PRE_FILTER=4]="PRE_FILTER",r[r.POST_FILTER=8]="POST_FILTER",r[r.ANY_HIT=16]="ANY_HIT",r[r.NO_BLOCK=32]="NO_BLOCK"})(O||(O={}));var W;(function(r){r[r.Enter=0]="Enter",r[r.Stay=1]="Stay",r[r.Exit=2]="Exit"})(W||(W={}));var bt=function(s,i){this.index1=s,this.index2=i},Mt=function(r){g(s,r);function s(i,t,e){var n;return n=r.call(this,i)||this,n._pxActor=i._pxPhysics.createRigidStatic(n._transform(t,e)),n}return s}(T),v;(function(r){r[r.Auto=0]="Auto",r[r.WebAssembly=1]="WebAssembly",r[r.JavaScript=2]="JavaScript"})(v||(v={}));var p=function(){function r(i){this._connectedAnchor=new l,this._breakForce=Number.MAX_VALUE,this._breakTorque=Number.MAX_VALUE,this._physXPhysics=i}var s=r.prototype;return s.setConnectedCollider=function(t){var e,n;this._pxJoint.setActors(((e=t)==null?void 0:e._pxActor)||null,((n=this._collider)==null?void 0:n._pxActor)||null)},s.setConnectedAnchor=function(t){this._connectedAnchor.copyFrom(t),this._setLocalPose(0,t,r._defaultQuat)},s.setConnectedMassScale=function(t){this._pxJoint.setInvMassScale0(1/t)},s.setConnectedInertiaScale=function(t){this._pxJoint.setInvInertiaScale0(1/t)},s.setMassScale=function(t){this._pxJoint.setInvMassScale1(1/t)},s.setInertiaScale=function(t){this._pxJoint.setInvInertiaScale1(1/t)},s.setBreakForce=function(t){this._breakForce=t,this._pxJoint.setBreakForce(this._breakForce,this._breakTorque)},s.setBreakTorque=function(t){this._breakTorque=t,this._pxJoint.setBreakForce(this._breakForce,this._breakTorque)},s._setLocalPose=function(t,e,n){this._pxJoint.setLocalPose(t,e,n)},r}();(function(){p._xAxis=new l(1,0,0)})();(function(){p._defaultVec=new l})();(function(){p._defaultQuat=new x})();var Et=function(r){g(s,r);function s(i,t){var e;return e=r.call(this,i)||this,e._collider=t,e._pxJoint=i._pxPhysics.createFixedJoint(null,p._defaultVec,p._defaultQuat,t._pxActor,p._defaultVec,p._defaultQuat),e}return s}(p),Dt=function(r){g(s,r);function s(t,e){var n;return n=r.call(this,t)||this,n._axisRotationQuaternion=new x,n._swingOffset=new l,n._collider=e,n._pxJoint=t._pxPhysics.createRevoluteJoint(null,p._defaultVec,p._defaultQuat,e._pxActor,p._defaultVec,p._defaultQuat),n}var i=s.prototype;return i.setAxis=function(e){var n=p._xAxis,a=this._axisRotationQuaternion;n.set(1,0,0),e.normalize();var o=Math.acos(l.dot(n,e));l.cross(n,e,n),x.rotationAxisAngle(n,o,a),this._setLocalPose(0,this._swingOffset,a)},i.setSwingOffset=function(e){this._swingOffset.copyFrom(e),this._setLocalPose(1,this._swingOffset,this._axisRotationQuaternion)},i.getAngle=function(){return this._pxJoint.getAngle()},i.getVelocity=function(){return this._pxJoint.getVelocity()},i.setHardLimit=function(e,n,a){this._pxJoint.setHardLimit(e,n,a)},i.setSoftLimit=function(e,n,a,o){this._pxJoint.setSoftLimit(e,n,a,o)},i.setDriveVelocity=function(e,n){n===void 0&&(n=!0),this._pxJoint.setDriveVelocity(e,n)},i.setDriveForceLimit=function(e){this._pxJoint.setDriveForceLimit(e)},i.setDriveGearRatio=function(e){this._pxJoint.setDriveGearRatio(e)},i.setHingeJointFlag=function(e,n){this._pxJoint.setRevoluteJointFlag(e,n)},s}(p),kt=function(r){g(s,r);function s(t,e){var n;return n=r.call(this,t)||this,n._swingOffset=new l,n._collider=e,n._pxJoint=t._pxPhysics.createDistanceJoint(null,p._defaultVec,p._defaultQuat,e._pxActor,p._defaultVec,p._defaultQuat),n._pxJoint.setDistanceJointFlag(2,!0),n._pxJoint.setDistanceJointFlag(4,!0),n._pxJoint.setDistanceJointFlag(8,!0),n}var i=s.prototype;return i.setSwingOffset=function(e){this._swingOffset.copyFrom(e),this._setLocalPose(1,e,p._defaultQuat)},i.setMinDistance=function(e){this._pxJoint.setMinDistance(e)},i.setMaxDistance=function(e){this._pxJoint.setMaxDistance(e)},i.setTolerance=function(e){this._pxJoint.setTolerance(e)},i.setStiffness=function(e){this._pxJoint.setStiffness(e)},i.setDamping=function(e){this._pxJoint.setDamping(e)},s}(p),It=function(r){g(s,r);function s(i,t,e){var n;return n=r.call(this,i)||this,n._axis=new x(0,0,y.halfSqrt,y.halfSqrt),n._physXRotation.copyFrom(n._axis),n._pxGeometry=new i._physX.PxPlaneGeometry,n._initialize(e,t),n._setLocalPose(),n}return s}(y),Tt=function(r){g(s,r);function s(t,e,n,a){var o;return o=r.call(this,t)||this,o._maxScale=1,o._radius=n,o._pxGeometry=new t._physX.PxSphereGeometry(o._radius*o._maxScale),o._initialize(a,e),o._setLocalPose(),o}var i=s.prototype;return i.setRadius=function(e){this._radius=e,this._pxGeometry.radius=e*this._maxScale,this._pxShape.setGeometry(this._pxGeometry)},i.setWorldScale=function(e){r.prototype.setWorldScale.call(this,e),this._maxScale=Math.max(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),this._pxGeometry.radius=this._radius*this._maxScale,this._pxShape.setGeometry(this._pxGeometry)},s}(y),Rt=function(){function r(i){i===void 0&&(i=v.Auto),this._initializeState=0,this._runTimeMode=i}var s=r.prototype;return s.initialize=function(){var t=this;if(this._initializeState===2)return Promise.resolve();if(this._initializeState===1)return this._initializePromise;var e=this._runTimeMode,n=new Promise(function(o,h){var c=document.createElement("script");if(document.body.appendChild(c),c.async=!0,c.onload=o,c.onerror=h,e==v.Auto){var u=function(){try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){var d=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(A(d,WebAssembly.Module))return A(new WebAssembly.Instance(d),WebAssembly.Instance)}}catch{}return!1}();u?e=v.WebAssembly:e=v.JavaScript}e==v.JavaScript?c.src="https://mdn.alipayobjects.com/rms/afts/file/A*rnDeR58NNGoAAAAAAAAAAAAAARQnAQ/physx.release.js.js":e==v.WebAssembly&&(c.src="https://mdn.alipayobjects.com/rms/afts/file/A*nA97QLQehRMAAAAAAAAAAAAAARQnAQ/physx.release.js")}),a=new Promise(function(o,h){n.then(function(){return window.PHYSX().then(function(c){t._init(c),t._initializeState=2,t._initializePromise=null,console.log("PhysX loaded."),o()},h)},h).catch(h)});return this._initializePromise=a,a},s.destroy=function(){this._physX.PxCloseExtensions(),this._pxPhysics.release(),this._pxFoundation.release(),this._physX=null,this._pxFoundation=null,this._pxPhysics=null},s.createPhysicsManager=function(){return new Pt},s.createPhysicsScene=function(t,e,n,a,o,h,c){var u=new F(this,t,e,n,a,o,h,c);return u},s.createStaticCollider=function(t,e){return new Mt(this,t,e)},s.createDynamicCollider=function(t,e){return new R(this,t,e)},s.createCharacterController=function(){return new Z(this)},s.createPhysicsMaterial=function(t,e,n,a,o){return new At(this,t,e,n,a,o)},s.createBoxColliderShape=function(t,e,n){return new I(this,t,e,n)},s.createSphereColliderShape=function(t,e,n){return new Tt(this,t,e,n)},s.createPlaneColliderShape=function(t,e){return new It(this,t,e)},s.createCapsuleColliderShape=function(t,e,n,a){return new $(this,t,e,n,a)},s.createFixedJoint=function(t){return new Et(this,t)},s.createHingeJoint=function(t){return new Dt(this,t)},s.createSpringJoint=function(t){return new kt(this,t)},s._init=function(t){var e=t.PX_PHYSICS_VERSION,n=new t.PxDefaultErrorCallback,a=new t.PxDefaultAllocator,o=t.PxCreateFoundation(e,a,n),h=t.PxCreatePhysics(e,o,new t.PxTolerancesScale,!1,null);t.PxInitExtensions(h,null),this._physX=t,this._pxFoundation=o,this._pxPhysics=h},r}(),V;(function(r){r[r.Uninitialized=0]="Uninitialized",r[r.Initializing=1]="Initializing",r[r.Initialized=2]="Initialized"})(V||(V={}));var Ft="1.2.0-beta.3";console.log("Galacean PhysX version: "+Ft);function Lt(r){const s=new x;Ht(r,new l(30,0,30),new l,new x);var i=0;setInterval(()=>{i>700||(zt(r,new l(.075,.075,.075),new l(Math.random()-.5,Math.random()*2+2.5,Math.random()-.5),s),i++)},16)}function Ht(r,s,i,t){const e=new U(r.engine);e.baseColor.set(.2179807202597362,.2939682161541871,.31177952549087606,1),e.roughness=0,e.metallic=0;const n=r.createChild();n.layer=at.Layer1;const a=n.addComponent(Q);a.mesh=j.createCuboid(r.engine,s.x,s.y,s.z),a.setMaterial(e),n.transform.position=i,n.transform.rotationQuaternion=t,a.receiveShadows=!1;const o=new ot;return o.position.set(0,s.y,0),n.addComponent(ht).addShape(o),n}function zt(r,s,i,t){const e=new U(r.engine);e.baseColor.set(Math.random(),Math.random(),Math.random(),1),e.metallic=0,e.roughness=.5;const n=r.createChild(),a=n.addComponent(Q);a.mesh=j.createCuboid(r.engine,s.x,s.y,s.z),a.setMaterial(e),n.transform.position=i,n.transform.rotationQuaternion=t,a.castShadows=!1;const o=new lt;return o.size=s,o.isTrigger=!1,n.addComponent(ct).addShape(o),n}et.create({canvas:"canvas",physics:new Rt}).then(r=>{r.canvas.resizeByClientSize();const s=r.sceneManager.activeScene;s.shadowDistance=50;const i=s.createRootEntity(),t=i.createChild("camera");t.addComponent(it),t.transform.position.set(-1,1.5,2),t.transform.lookAt(new l),t.addComponent(ut),t.addComponent(Ct);const n=i.createChild("light");n.transform.setPosition(-.3,1,.4),n.transform.lookAt(new l(0,0,0));const a=n.addComponent(nt);a.intensity=1,a.shadowType=st.SoftLow,a.shadowStrength=1,Lt(i),r.resourceManager.load({type:rt.Env,url:"https://gw.alipayobjects.com/os/bmw-prod/89c54544-1184-45a1-b0f5-c0b17e5c3e68.bin"}).then(o=>{s.ambientLight=o,r.run()})});
